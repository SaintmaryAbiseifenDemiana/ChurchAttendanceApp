<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ†</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { font-family: Tahoma, sans-serif; padding-top: 50px; }
        .container { max-width: 600px; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="text-center mb-4">Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† (Ø§Ù„ÙØµÙˆÙ„ ÙˆØ§Ù„Ø±Ø¨Ø·)</h2>
        
        <div class="card p-4 shadow">
            <p>Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ù…Ù„Ù Ø§Ù„Ø¥ÙƒØ³Ù„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªØ§Ù„ÙŠØ© ØªÙ…Ø§Ù…Ø§Ù‹ ÙÙŠ Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø©:</p>
            <ul class="list-unstyled mb-4 alert alert-info">
                <li><code>serviced_name</code></li>
                <li><code>family_name</code></li>
                <li><code>class_name</code></li>
                <li><code>servant_username</code> (Ø§Ø³Ù… Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø®Ø§Ø¯Ù… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„)</li>
            </ul>

            <form id="importForm" enctype="multipart/form-data">
                <div class="form-group">
                    <label for="servicedFile">Ù…Ù„Ù Ø§Ù„Ù…Ø®Ø¯ÙˆÙ…ÙŠÙ† (Excel/CSV):</label>
                    <input type="file" class="form-control-file" id="servicedFile" name="servicedFile" accept=".xlsx, .xls, .csv" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block" id="importBtn">Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯</button>
            </form>
            
            <div id="message" class="mt-3 text-center"></div>
        </div>
        <div class="mt-3 text-center">
            <a href="admin-dashboard.html" class="btn btn-secondary">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</a>

        </div>
    </div>

    <script>
        document.getElementById('importForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            const messageDiv = document.getElementById('message');
            const importBtn = document.getElementById('importBtn');

            const fileInput = document.getElementById('servicedFile');
            if (fileInput.files.length === 0) {
                messageDiv.className = 'alert alert-danger';
                messageDiv.textContent = 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹.';
                return;
            }

            const formData = new FormData();
            formData.append('servicedFile', fileInput.files[0]);

            importBtn.disabled = true;
            messageDiv.className = 'alert alert-info';
            messageDiv.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯... Ù‚Ø¯ ÙŠØ³ØªØºØ±Ù‚ Ø§Ù„Ø£Ù…Ø± Ø¨Ø¹Ø¶ Ø§Ù„ÙˆÙ‚Øª.';

            try {
                // ğŸš¨ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø°ÙŠ Ø£Ù†Ø´Ø£Ù†Ø§Ù‡ ÙÙŠ server.js
                const response = await fetch('/api/admin/import-serviced', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();

                if (data.success) {
                    messageDiv.className = 'alert alert-success';
                    messageDiv.textContent = data.message;
                } else {
                    messageDiv.className = 'alert alert-danger';
                    messageDiv.textContent = data.message || 'ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯. ØªØ­Ù‚Ù‚ Ù…Ù† Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù„Ù ÙˆØ£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø©.';
                    console.error('Import Failed:', data.message);
                }
            } catch (error) {
                messageDiv.className = 'alert alert-danger';
                messageDiv.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…: ' + error.message;
                console.error('Network Error:', error);
            } finally {
                importBtn.disabled = false;
            }
        });
    </script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="admin-dashboard.js"></script>
</body>
</html>